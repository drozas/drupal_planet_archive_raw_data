X-Mozilla-Status: 0041
X-Mozilla-Status2: 00000000
X-Mozilla-Keys:                                                                                
Date: Mon, 07 Jul 2014 19:57:59 +0000
Message-Id: <http://drupal.org/planet/rss.xml#Mon, 07 Jul 2014 19:57:59 +0000@localhost.localdomain>
From: <Drupal Planet>
MIME-Version: 1.0
Subject: Chuva Inc.: Entity Metathing what? -- A very brief introduction on entity_metadata_wrappers
Content-Transfer-Encoding: 8bit
Content-Base: http://chuva-inc.com/blog/2014/07/entity-metathing-what-very-brief-introduction-entitymetadatawrappers
Content-Type: text/html; charset=UTF-8

<html>
  <head>
    <title>Chuva Inc.: Entity Metathing what? -- A very brief introduction on entity_metadata_wrappers</title>
    <base href="http://chuva-inc.com/blog/2014/07/entity-metathing-what-very-brief-introduction-entitymetadatawrappers">
  </head>
  <body id="msgFeedSummaryBody" selected="false">
    <div id="comment-wrapper"></div><div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even"><p>Are you familiar with entity_metadata_wrappers? If you’re not, oh boy, you should be!</p><p><span style="line-height: 1.6em;">Entity Metadata Wrapper is the right way - and, after you get the grip of it, the easiest way - for you to manipulate anything with a field when coding your module. Sure, since the old days of CCK we are used with dealing with our fields in our nodes. Except they are a little messy.</span></p><h2><span style="line-height: 1.6em;">Cleaner code!</span></h2><p>Instead of doing this:</p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$first_name </span><span style="color: #007700">= </span><span style="color: #DD0000">''</span><span style="color: #007700">;<br />if (!empty(</span><span style="color: #0000BB">$node</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">field_first_name</span><span style="color: #007700">)) {<br />  </span><span style="color: #0000BB">$name </span><span style="color: #007700">= </span><span style="color: #0000BB">$node</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">field_first_name</span><span style="color: #007700">[</span><span style="color: #0000BB">LANGUAGE_NONE</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #DD0000">'value'</span><span style="color: #007700">];<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div><p>Let’s condense that, shall we?</p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$node_wrapper </span><span style="color: #007700">= </span><span style="color: #0000BB">entity_metadata_wrapper</span><span style="color: #007700">(</span><span style="color: #DD0000">'node'</span><span style="color: #007700">, </span><span style="color: #0000BB">$node</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$first_name </span><span style="color: #007700">= </span><span style="color: #0000BB">$node_wrapper</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">field_first_name</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">value</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div><p>Sure, the name “metadata wrapper” may be a little intimidating, but it does shortens your code and makes it clearer. Oh, and if you have an entity reference field, or a file field, you can just do this:</p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$image </span><span style="color: #007700">= </span><span style="color: #0000BB">$node_wrapper</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">field_image</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">value</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div><p>And the $referenced_node is already a loaded file object, not a useless “fid”.</p><h2>Wrappers for dealing with entity reference: cleaner-er code!</h2><p>Suppose you have two node types: Employee and Department. There is an Entity reference field from "Employee" to "Department" and on the "Department" node you have a field called "field_dept_phone" that stores the phone number. (for simplicity, I'm assuming that field_employee_dept is required).</p><p>If you have the $employee node, how to fetch the phone number?</p><p>Hard way:</p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$phone </span><span style="color: #007700">= </span><span style="color: #DD0000">''</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$department </span><span style="color: #007700">= </span><span style="color: #0000BB">node_load</span><span style="color: #007700">(</span><span style="color: #0000BB">$employee</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">field_employee_dept</span><span style="color: #007700">[</span><span style="color: #0000BB">LANGUAGE_NONE</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #DD0000">'target_id'</span><span style="color: #007700">]);<br />if (</span><span style="color: #0000BB">$department </span><span style="color: #007700">&amp;&amp; !empty(</span><span style="color: #0000BB">$department</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">field_dept_phone</span><span style="color: #007700">[</span><span style="color: #0000BB">LANGUAGE_NONE</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #DD0000">'value'</span><span style="color: #007700">])) {<br />  </span><span style="color: #0000BB">$phone </span><span style="color: #007700">= </span><span style="color: #0000BB">$department</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">field_dept_phone</span><span style="color: #007700">[</span><span style="color: #0000BB">LANGUAGE_NONE</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #DD0000">'value'</span><span style="color: #007700">];<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div><p>And the wrapper way:</p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$wrapper </span><span style="color: #007700">= </span><span style="color: #0000BB">entity_metadata_wrapper</span><span style="color: #007700">(</span><span style="color: #DD0000">'node'</span><span style="color: #007700">, </span><span style="color: #0000BB">$employee</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$phone </span><span style="color: #007700">= </span><span style="color: #0000BB">$wrapper</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">field_employee_dept</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">field_dept_phone</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">value</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div><p> </p><h2>Now what?</h2><p>Well, this post is not intended to be a full entity metadata wrapper course, so, if I have convinced you, take 15 minutes of your day and do this:</p><ol><li>Download Entity API from <a href="http://drupal.org/project/entity">http://drupal.org/project/entity</a></li><li>Read this, now: <a href="https://drupal.org/node/1021556">https://drupal.org/node/1021556</a></li><li>Your life quality will improve, proportionally to your code quality!</li></ol><p><sub><em>Photo credits: <a href="https://www.flickr.com/photos/81564552">https://www.flickr.com/photos/81564552</a>@N00/3208209972/</em></sub></p></div></div></div><div class="field field-name-taxonomy-vocabulary-2 field-type-taxonomy-term-reference field-label-hidden"><div class="field-items"><div class="field-item even"><a href="http://chuva-inc.com/blog/tags/php">PHP</a></div><div class="field-item odd"><a href="http://chuva-inc.com/blog/tags/entity">entity</a></div><div class="field-item even"><a href="http://chuva-inc.com/blog/tags/entitymetadatawrappers">entity_metadata_wrappers</a></div><div class="field-item odd"><a href="http://chuva-inc.com/blog/tags/drupal-planet">drupal planet</a></div></div></div><div class="field field-name-field-top-image field-type-image field-label-hidden"><div class="field-items"><div class="field-item even"><img src="http://chuva-inc.com/sites/default/files/3208209972_190dac28f2_o.jpg" width="3072" height="2304" alt="" /></div></div></div>
  </body>
</html>

