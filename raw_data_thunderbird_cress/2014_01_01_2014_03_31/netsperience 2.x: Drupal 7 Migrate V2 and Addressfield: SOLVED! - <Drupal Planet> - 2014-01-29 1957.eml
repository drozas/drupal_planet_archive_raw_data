X-Mozilla-Status: 0000
X-Mozilla-Status2: 00000000
X-Mozilla-Keys:                                                                                
Date: Wed, 29 Jan 2014 19:57:49 +0000
Message-Id: <http://drupal.org/planet/rss.xml#Wed, 29 Jan 2014 19:57:49 +0000@localhost.localdomain>
From: <Drupal Planet>
MIME-Version: 1.0
Subject: netsperience 2.x: Drupal 7 Migrate V2 and Addressfield: SOLVED!
Content-Transfer-Encoding: 8bit
Content-Base: http://netsperience.org/content/blog/drupal-7-migrate-v2-and-addressfield-solved
Content-Type: text/html; charset=UTF-8

<html>
  <head>
    <title>netsperience 2.x: Drupal 7 Migrate V2 and Addressfield: SOLVED!</title>
    <base href="http://netsperience.org/content/blog/drupal-7-migrate-v2-and-addressfield-solved">
  </head>
  <body id="msgFeedSummaryBody" selected="false">
    <p><span style="font-size:14px;">I had to migrate site members from a legacy site with an Oracle db to a relaunch on Drupal 7. Instead of connecting directly to Oracle, I was provided with an Excel dump which I converted to csv. Also the old site does not require members to be authenticated, so I did not have to deal with old passwords.</span></p><p><span style="font-size: 14px;">There are a lot of stale posts in Google results about migrating Addressfield that do not work on the latest Migrate V2 for Drupal 7. For one thing <a href="https://drupal.org/node/1133448">arguments in the field mapping are deprecated.</a></span></p><p><span style="font-size:14px;">Using the <a href="https://drupal.org/project/migrate">Migrate module</a> I was able to create migration classes for the users, and some other information; but I got stuck at importing the address data into the Drupal <a href="https://drupal.org/project/addressfield">Addressfield</a> table, because it uses subfields and requires building an array in Migrate.</span></p><p><span style="font-size: 14px;">I used&nbsp;</span><a href="https://drupal.org/node/1133448" style="font-size: 14px;">colon notation for subfield mapping</a><span style="font-size: 14px;">, but it was not working.</span></p><p><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(0, 0, 187);">&lt;?php<br style="box-sizing: border-box;">&nbsp;&nbsp;&nbsp; $this</span><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(0, 119, 0);">-&gt;</span><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(0, 0, 187);">addFieldMapping</span><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(0, 119, 0);">(</span><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(221, 0, 0);">'body'</span><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(0, 119, 0);">, </span><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(221, 0, 0);">'body'</span><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(0, 119, 0);">);<br style="box-sizing: border-box;">&nbsp;&nbsp;&nbsp; </span><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(0, 0, 187);">$this</span><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(0, 119, 0);">-&gt;</span><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(0, 0, 187);">addFieldMapping</span><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(0, 119, 0);">(</span><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(221, 0, 0);">'body:summary'</span><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(0, 119, 0);">, </span><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(221, 0, 0);">'excerpt'</span><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(0, 119, 0);">);</span><br style="box-sizing: border-box;"><span style="box-sizing: border-box; margin: 0px; padding: 0px; border: 0px; font-family: 'Bitstream Vera Sans Mono', Monaco, 'Lucida Console', monospace; line-height: 17.984375px; vertical-align: baseline; white-space: pre-wrap; background-color: rgb(246, 246, 242); color: rgb(0, 0, 187);">?&gt;</span></p><p><span style="font-size: 14px;">Migrate kept throwing an error:&nbsp;</span><em style="font-size: 14px;">Call to a member function import() on a non-object</em></p><p><span style="font-size:14px;">But when I put <a href="http://api.drupalize.me/api/drupal/function/drush_print_r/7">drush_print_r</a> on the line throwing the code, I could see the <a href="http://www.php.net/manual/en/language.types.object.php">stdClass object</a>&nbsp;arrays were there and populated with the correct data.</span></p><p><span style="font-size:14px;">I decided to abandon the Addressfield migrate class and use <a href="https://api.drupal.org/api/drupal/includes%21database%21database.inc/function/db_insert/7">db_insert</a> in an existing class (<em>class SchoolMigration</em>) where I was already running db queries.</span></p><p><span style="font-size: 14px;">It worked, and although I was worried a direct db_insert would not roll back, since I registered the inserts in the process() function for&nbsp;</span><em><span style="font-size: 14px;">class SchoolMigration</span></em><span style="font-size: 14px;">, they also rolled back.</span></p><p><p><a href="http://netsperience.org/content/blog/drupal-7-migrate-v2-and-addressfield-solved" target="_blank">read more</a></p>
  </body>
</html>

