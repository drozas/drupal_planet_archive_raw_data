X-Mozilla-Status: 0000
X-Mozilla-Status2: 00000000
X-Mozilla-Keys:                                                                                
Date: Thu, 13 Mar 2014 17:42:47 +0000
Message-Id: <http://drupal.org/planet/rss.xml#Thu, 13 Mar 2014 17:42:47 +0000@localhost.localdomain>
From: <Drupal Planet>
MIME-Version: 1.0
Subject: Hook 42: Deleting a Drupal Field Saved in Features
Content-Transfer-Encoding: 8bit
Content-Base: http://www.hook42.com/blog/deleting-drupal-field-saved-features
Content-Type: text/html; charset=UTF-8

<html>
  <head>
    <title>Hook 42: Deleting a Drupal Field Saved in Features</title>
    <base href="http://www.hook42.com/blog/deleting-drupal-field-saved-features">
  </head>
  <body id="msgFeedSummaryBody" selected="false">
    <div class="image">
    <div class="field-items" class="field-items">
          <div class="field-item even" rel="og:image rdfs:seeAlso" resource="http://www.hook42.com/sites/default/files/styles/image_style_blog_detail/public/learn_1.png?itok=d5dOuMiX" class="field-item even"><img typeof="foaf:Image" src="http://www.hook42.com/sites/default/files/styles/image_style_blog_detail/public/learn_1.png?itok=d5dOuMiX" width="220" height="167" alt="Full Service Drupal Development" title="Full Service Drupal Development" /></div>
      </div>
</div>

<div class="field field-name-field-display-date field-type-date field-label-hidden field-wrapper">
    <div class="field-items" class="field-items">
          <div class="field-item even" class="field-item even"><span class="date-display-single" property="dc:date" datatype="xsd:dateTime" content="2014-03-13T00:00:00-07:00">Thursday, March 13, 2014</span></div>
      </div>
</div>

<div class="body field">
    <div class="field-items" class="field-items">
          <div class="field-item even" property="content:encoded" class="field-item even"><p>There comes a time in every Drupal developer's day when they realize they really don't need a field on some content type or other entity. Maybe it was a field holding temporary data while you did a migration or maybe a feature was removed or maybe things have been rearchitected to use a non-field approach.</p><p>Deleting a field might not sound terribly difficult but it does require being very careful and meticulous... particularly if that field has made it into production. With the help of <a href="http://drush.ws/" target="_blank">drush</a>, things get easier but, if you are using <a href="https://drupal.org/project/field_group" target="_blank">field groups</a> and/or <a href="https://drupal.org/project/ds" target="_blank">Display Suite</a>, you might have extra steps that aren't solved by drush (unless you happen to know how to do this via drush... if so, contact us... our comments theming isn't quite ready so no comments turned on yet ;).</p><h2>Assumptions</h2><p>I will assume:</p><ul><li>you are deleting a field from a content type</li><li>the field is live on the production site</li><li>you have a local =&gt; dev =&gt; stage =&gt; live development process</li><li>you are using <a href="http://git-scm.com/" target="_blank">git</a></li><li>the field configuration is saved in a feature (via <a href="https://drupal.org/project/features" target="_blank">Features</a> module)</li></ul><p>Let's say the field is called <strong>field_marketing_blurb</strong>, the content type is called <strong>marketing_post</strong>, the feature module is called <strong>marketing</strong> and the git branch we're working is called <strong>deleteblurb</strong>.</p><h2>Deleting the field locally</h2><ol><li>Get your code/branch sync'ed up with master<br>&nbsp;</li><li>Use a recent copy of the live database<br>&nbsp;</li><li>Revert all your features to make sure you are in sync:<br><br>drush fra --yes<br>&nbsp;</li><li>Make sure things really did revert successfully (you have no overrides)<br><br>drush features-list<br>&nbsp;</li><li>Check your code to see where the field is being used:<br><br><span style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">grep -r field_marketing_blurb .</span><br>&nbsp;</li><li>If you have custom code that refers to these fields, you'll need to update the code to pull these out<br>&nbsp;</li><li>If there are views, rules, context, etc. referring to the field, you'll need to update these to pull these out (you will know if they are used if you have been saving your config into features code ;)<br>&nbsp;</li><li>Check again to make sure you removed references beyond the content type (step #5) (the content type field info will refer to base and instance configuration)<br>&nbsp;</li><li>Now you can delete the field with drush:<br><br><span style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">drush field-delete&nbsp;field_marketing_blurb</span><br>&nbsp;</li><li>Check the field was actually deleted:<br><br>drush field-info fields | grep field_marketing_blurb<br>&nbsp;</li><li>To be really sure there is nothing left in database, you can do some queries:<br><br><span style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">show tables like '%<span style="line-height: 20.006303787231445px;">field_marketing_blurb</span>%'<br>select * from variable where name like '%<span style="line-height: 20.006303787231445px;">field_marketing_blurb</span>%';</span><br>&nbsp;</li><li>Once you are all clear, then you can recreate your feature that included the field:<br><br><span style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">drush fu --yes marketing</span><br>&nbsp;</li><li>Now there should be nothing in the codebase referring to this field:<br><br><span style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">grep -r field_marketing_blurb .</span><br>&nbsp;</li><li>But, if you are using field_group, you might have some references left for that so go to your managed fields page for the content type and click the save button and then repeat&nbsp;steps 12 and 13<br>&nbsp;</li><li>And, if you use Display Suite, you might have some references left for that so go to the manage display page for *<strong>EACH</strong>* view mode and click save and then repeat steps 12 and 13<br>&nbsp;</li><li>If you still have some references in your feature module, you'll need to look at the code to see what is referring to it and handle accordingly (for most cases, the steps above will work)<br>&nbsp;</li><li><strong>VERY IMPORTANT</strong>: for each feature you have changed (and any custom code you change), make sure that the code changed makes sense:<br><br>git diff marketing<br>&nbsp;</li><li>Once you are convinced that all is well and you aren't introducing changes you shouldn't, commit the code:<br><br>git commit marketing<br>&nbsp;</li><li>Now, we'll double check that features is happy by reverting the feature and recreating:<br><br><span style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">drush fr --yes marketing<br>drush fu --yes marketing<br>git diff marketing</span><br>&nbsp;</li><li>You shouldn't see any changes<br>&nbsp;</li></ol><h2 style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">Testing your changes<br>&nbsp;</h2><ol><li>Test locally and make sure things are work and/or run automated tests if you have them<br>&nbsp;</li><li>Push code to your branch:<br><p><br>git push origin deleteblurb</p></li><li><p><span style="line-height: 1.538em;">If you have peer review cycle, have someone sanity check your branch before merging:</span></p>git checkout deleteblurb<br>git diff origin/master<br>&nbsp;</li><li>If all good, merge code and push:<br><br>git checkout master<br>git merge deleteblurb<br>git push origin master<br>&nbsp;</li><li>On dev site, revert all features and clear cache (this assumes dev site uses master branch code):<br><br>drush @alias-to-dev-site fra --yes<br>drush @alias-to-dev-site&nbsp;cc all<br>&nbsp;</li><li>On dev site, run drush field-delete:<br><br><span style="line-height: 1.538em;">drush @alias-to-dev-site field-delete field_marketing_blurb</span><br>&nbsp;</li><li>Test on dev site<br>&nbsp;</li><li>If all good, merge code to test branch (or, depending on your workflow, tag and push to test)<br>&nbsp;</li><li><p><span style="line-height: 1.538em;">On test site, revert all features and clear cache:</span></p><p>drush @alias-to-test-site fra --yes<br>drush @alias-to-test-site&nbsp;cc all</p></li><li><p>On test site, run drush field-delete:<br><br>drush @alias-to-test-site field-delete field_marketing_blurb</p></li><li>Test on test site<br>&nbsp;</li><li>Have client test on test site</li></ol><h2>Push changes to live</h2><ol><li style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">Backup database<br>&nbsp;</li><li style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">Put site into maintenance mode<br>&nbsp;</li><li style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">Push code to live<br>&nbsp;</li><li style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">Revert all features and clear cache:<br><br>drush @alias-to-live-site fra --yes<br>drush @alias-to-live-site cc all<br>&nbsp;</li><li style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">Make sure features are reverted<br><br>drush @alias-to-live-site features-list<br>&nbsp;</li><li style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;"><strong>CAREFULLY</strong> delete field via drush (have command handy for easy copy/pasting to minimize error):<br><br>drush @alias-to-live-site field-delete field_marketing_blurb<br>&nbsp;</li><li style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">Make sure field is deleted<br><br>drush @alias-to-live-site&nbsp;field-info fields | grep field_marketing_blurb<br>&nbsp;</li><li style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">Test site<br>&nbsp;</li><li style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">Disable maintenance mode</li></ol><div style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">&nbsp;</div><h2 style="font-family: ProximaNovaRegular, Arial, Helvetica, sans-serif; line-height: 20px;">Have a &lt;beverage of choice&gt;!</h2><p>&nbsp;</p></div>
      </div>
</div>

<div class="field field-name-field-display-author field-type-entityreference field-label-hidden field-wrapper">
    <div class="field-items" class="field-items">
          <div class="field-item even" class="field-item even">Kristen Pol</div>
      </div>
</div>
<div class="field field-name-field-topics-tr field-type-taxonomy-term-reference field-label-inline clearfix field-wrapper"><h2 class="field-label">Topics: </h2><ul class="links inline"><li class="taxonomy-term-reference-0" class="field-item even"><a href="/blog/drupal" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Drupal</a></li><li class="taxonomy-term-reference-1" class="field-item even odd"><a href="/blog/drupal-planet" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Drupal Planet</a></li><li class="taxonomy-term-reference-2" class="field-item even odd even"><a href="/blog/howto" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Howto</a></li></ul></div><div class="field field-name-field-service-tr field-type-taxonomy-term-reference field-label-inline clearfix field-wrapper"><h2 class="field-label">Services: </h2><ul class="links inline"><li class="taxonomy-term-reference-0" class="field-item even"><a href="/service/development" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Development</a></li><li class="taxonomy-term-reference-1" class="field-item even odd"><a href="/service/drupal" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Drupal</a></li></ul></div>
  </body>
</html>

