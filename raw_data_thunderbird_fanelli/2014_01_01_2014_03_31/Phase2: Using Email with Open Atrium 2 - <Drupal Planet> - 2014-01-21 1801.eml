X-Mozilla-Status: 0000
X-Mozilla-Status2: 00000000
X-Mozilla-Keys:                                                                                
Date: Tue, 21 Jan 2014 17:01:16 +0000
Message-Id: <http://drupal.org/planet/rss.xml#Tue, 21 Jan 2014 17:01:16 +0000@localhost.localdomain>
From: <Drupal Planet>
MIME-Version: 1.0
Subject: Phase2: Using Email with Open Atrium 2
Content-Transfer-Encoding: 8bit
Content-Base: http://www.phase2technology.com/blog/using-email-with-open-atrium-2/?utm_source=rss&utm_medium=rss&utm_campaign=using-email-with-open-atrium-2
Content-Type: text/html; charset=UTF-8

<html>
  <head>
    <title>Phase2: Using Email with Open Atrium 2</title>
    <base href="http://www.phase2technology.com/blog/using-email-with-open-atrium-2/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=using-email-with-open-atrium-2">
  </head>
  <body id="msgFeedSummaryBody" selected="false">
    <p><img class="size-full wp-image-2508 alignleft" alt="atrium-logo" src="http://www.phase2technology.com/wp-content/uploads/2013/03/atrium-logo.png" width="300" height="82" /> One purpose of collaboration tools is to move beyond standard email communications.  When collaborating with a team on a project you don&#8217;t want important messages stuck in somebody&#8217;s email inbox.  By posting all messages to a common discussion area, the entire team can stay informed.  However, most of us still use email on a regular basis.  Using an additional collaboration tool can often become a burden of extra work.  This isn&#8217;t a problem with <a href="http://openatrium.com">Open Atrium 2</a> because it fully integrates with your existing email workflow.  In this article, I&#8217;ll describe how the Open Atrium 2 collaboration tool can send information to your email, as well as how you can post messages back to OA2 using email.</p>
<h2>Notifications</h2>
<p style="text-align: right;"><img class="size-full wp-image-6394 alignright" alt="OA2_Notifications-2" src="http://www.phase2technology.com/wp-content/uploads/2014/01/OA2_Notifications-2.png" width="329" height="341" /></p>
<p>One of the core features of Open Atrium 2 is the notification system.  A notification is just a simple message about something that happened within the collaboration space.  For example, a new post was created, or a document was changed, or a reply was added to a discussion thread.  These notification messages are summarized in the Recent Activity stream within each collaboration space.  When you create a new piece of content, you decide who will be notified: groups, teams, and/or individual users.  When the content is changed, or commented, notification emails will be sent to that collection of users.  The HTML templates used for these email messages can be customized for your specific site and can use Drupal tokens to insert elements such as the title of the content, who changed it, etc.  The default &#8220;content changed&#8221; message is even configured to show the specific changes (diff) between the old version and the new.</p>
<h2>Message Digests</h2>
<p>Within the Settings page of the user dashboard, each user can customize what kinds of notifications generate emails for each collaboration space the user is a member of.  For example, maybe you don&#8217;t want to get an email when content is deleted and only when it is added or changed.  Perhaps you don&#8217;t want to receive any email at all from certain spaces.  Open Atrium 2 even allows you to summarize the notification activity into <a href="http://www.phase2technology.com/blog/introducing-message-digests-for-open-atrium-2/">daily or weekly digest</a> emails.  You can even control whether you receive a separate digest message for each collaboration space, or whether you wish to receive a single message that summarizes all of your spaces.</p>
<h2>Emailing replies back to Open Atrium</h2>
<p>Getting email notifications is great and is part of most collaboration software.  They allow you to keep your normal email workflow and be notified when there is something important to see in your project spaces.  But Open Atrium goes even further than that:  it allows you to actually <strong>reply</strong> to those notifications within your email client and have your reply posted back into the OA2 space!  This feature is especially critical for mobile users.  Even with a mobile-friendly responsive web application such as Open Atrium, who wants to switch to another app just to reply to a discussion that you received a notification about in your email? The &#8220;email reply&#8221; feature is not included in the base Open Atrium 2 distribution because it requires a software library that might not be installed on your server by default.  So let me show you exactly how you set up this important feature on your Open Atrium 2 site.</p>
<h3>Installing Open Atrium Mailhandler</h3>
<p>The optional module that adds &#8220;email reply&#8221; support is the <a href="http://drupal.org/project/oa_mailhandler">OA2 Mailhandler</a> module.  Download this module from drupal.org and place it into your sites/all/modules folder.  You will also need to download the dependent modules: mailhandler, mailcomment, and feeds_comment_processor.  Place them also into your sites/all/modules folder.  Then enable oa_mailhandler and agree when asked to enable the dependent modules. Using Mailhandler requires that you have the PHP IMAP extension installed on your server.  This is a common PHP extension so you might already have it.  If not, you&#8217;ll need to ask your system administrator to <a href="http://drupal.org/node/300794">install it</a> and restart your web server.</p>
<h3>Adding your OA2 Mailbox</h3>
<p>Once you have OA2 Mailhandler installed and enabled you need to configure the email account that you will be using.  When a user replies to an email notification, that reply needs to go to some email address that you configure.  This needs to be a real email account that can store messages and which supports IMAP.  Every few minutes your Open Atrium site will query this mailbox to see if any new messages have been received.  When a message is received, it is taken from the mailbox and posted to the proper discussion thread in your OA2 site via the Feeds module. To set up this mailbox, go to admin/structure/mailhandler and click the Add link.  Give this mailbox a name, then enter the server hostname into the Domain field (for gmail this is: imap.gmail.com), then the Port number, Username, and Password.  An easy way to get all of this information is to add this mailbox to your normal email client.  Most email clients can configure a server just by entering the email address and password.  You can then look at the server settings for Domain/Host, Port, Username and copy them to the Open Atrium configuration page.  When you save your mailbox configuration, Drupal will test the connection to your mail server and verify that it is working. Once this is all working, the final step is to set the email address of your OA2 site.  Go to admin/config/system/site-information and enter the full email address of your mailbox into the &#8220;Mailbox E-mail address&#8221; field.  This will become the &#8220;reply-to&#8221; address of the notification messages.  If you also want to set the &#8220;from&#8221; address of these messages, change the normal Drupal &#8220;E-mail address&#8221; field to match.</p>
<h3>Scheduling Email Import</h3>
<p>When you reply to a notification email, your reply will be sent to the mailbox that you configured in the previous section.  By default, Open Atrium 2 will only fetch email replies and post them to your discussion threads whenever the &#8220;cron&#8221; task runs.  The &#8220;cron&#8221; task in Drupal runs periodically and performs all sorts of maintenance functions on your site, including checking for new versions of modules, indexing your search, etc.  By default it runs every 3 hours, but only when somebody actually views a page on your web site (this is the reason Drupal is slower the first time you fetch a page on your development server if no pages have been accessed in the past three hours).  You can change your Drupal cron interval at admin/config/system/cron, but the minimum value is still one-hour.  You probably want to fetch email more often than that, but you also probably don&#8217;t want to run all of the other cron tasks as often. The <a href="http://drupal.org/project/elysia_cron">Elysia Cron</a> module (among others) can help with this.  After installing it, you can visit admin/config/system/cron to fine tune when each different cron task is run.  For example, you can configure your email fetching by setting the feeds_cron and job_scheduler_cron tasks to run every couple of minutes, while keeping your search index at once an hour, and perhaps your Drupal update checker at once a day.  Follow the instructions given for the Elysia Cron module on how to set up a cron job on your web server to run this task every minute.</p>
<h3>How does this all work securely?</h3>
<p>When Open Atrium sends a notification email that can be replied to, it appends a secure token to the subject line, such as [#123-45678].  This token is unique per discussion post and is used to route the reply back to the correct discussion thread.  When a user replies to this email notification, Open Atrium verifies this secure token and also checks the email address of the reply to see which Drupal user account it matches.  OA2 then checks to ensure that this user account has permission to post content to the specified discussion thread.  While email addresses can be spoofed, the addition of the unique secure token for each discussion thread should prevent both spam and unauthorized posting.  Just ensure that your users are not sharing the email messages with the tokens to outside users. Sometimes a user might have more than one email account.  You can use the <a href="http://drupal.org/project/multiple_email">Multiple Email Addresses </a>module to add more than one email to use Drupal user so OA2 will accept replies from any of a user&#8217;s mail accounts.</p>
<h2>Conclusion</h2>
<p>If you have any trouble setting up <a href="https://drupal.org/project/mailhandler">Mailhandler</a>, take a look at the documentation for that module, and for related modules such as Feeds.  Once you have it set up your Open Atrium users will thank you for integrating their new collaboration tool with their regular email workflow!  Check out more Open Atrium news and updates on the <a href="http://docs.openatrium.com/">Open Atrium documentation site!</a></p>
  </body>
</html>

