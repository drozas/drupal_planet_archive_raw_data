X-Mozilla-Status: 0041
X-Mozilla-Status2: 00000000
X-Mozilla-Keys:                                                                                
Date: Tue, 12 Aug 2014 17:36:48 +0000
Message-Id: <http://drupal.org/planet/rss.xml#Tue, 12 Aug 2014 17:36:48 +0000@localhost.localdomain>
From: <Drupal Planet>
MIME-Version: 1.0
Subject: Propeople Blog: How We Use Vagrant In Our Drupal Development Workflow
Content-Transfer-Encoding: 8bit
Content-Base: http://wearepropeople.com/blog/how-we-use-vagrant-in-our-drupal-development-workflow
Content-Type: text/html; charset=UTF-8

<html>
  <head>
    <title>Propeople Blog: How We Use Vagrant In Our Drupal Development Workflow</title>
    <base href="http://wearepropeople.com/blog/how-we-use-vagrant-in-our-drupal-development-workflow">
  </head>
  <body id="msgFeedSummaryBody" selected="false">
    <div id="comment-wrapper-nid-1506"></div><div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p dir="ltr"><span style="line-height: 1.538em;">A lot of Drupal companies have started adopting virtual development environments. This has a lot of benefits for unifying the way people collaborate on projects. The main idea behind it is to have everyone working on the same environment, following the same production set up. Using a virtual environment, you can standardize what versions of PHP, MySQL, Apache, Nginx, Memcache, Varnish, Solr, Sass/Compass libraries, etc. are used. This way, you do not have to worry about things like setting up your front-end developer on their Mac, Windows, or Linux machine with a bunch of software for a particular project. In this article I would like to share some thoughts on how we at Propeople utilize <a href="http://www.vagrantup.com/">Vagrant</a>, an open-source software that we use to create virtual </span><a href="/blog/complex-development-environment-simplified-with-vagrant" style="line-height: 1.538em;">development environments</a><span style="line-height: 1.538em;">.</span></p><p dir="ltr"> </p><h3 dir="ltr">Starting point</h3><p>When we start a <a href="/clients">Drupal project</a>, we do not just keep the Drupal codebase in the repo. We also keep configuration files of Vagrant and the Drupal repo. We use configurations from puphpet.com as a starting point but add some customizations on top. Based on our production set up (version of operating system, web server, PHP versions) we generate configs and then adjust them to our needs. One example of such a code structure can be seen at<a href="https://github.com/podarok/ppdorg"> https://github.com/podarok/ppdorg</a>. Here is the basic structure:</p><p><span id="docs-internal-guid-685d6eab-cb47-8210-3423-b55b010304fd"><span style="font-size: 15px; font-family: Arial; white-space: pre-wrap; background-color: transparent;"><img height="264px;" src="https://lh3.googleusercontent.com/wvGlvq6Qi5B_3i3AUWBJQGuMTVV-icALBDl1urOzhT2XPopVZ09I-xXPUlQh7jFyxNWSRyd7Zqz5dzKYQUXGwIvA-A-gD4OgQQ6_vu4GcUca1E-5Bt4WRrL3qOdtTgWEOQ" style="border-style: none; transform: rotate(0rad); -webkit-transform: rotate(0rad);" width="624px;" /></span></span></p><p> </p><h3 dir="ltr">IP address and tools</h3><p dir="ltr">We use a virtual host for the project. For example, after bringing up the virtual machine, we can use the URL <a href="http://ppdorg.192.168.56.112.xip.io">http://ppdorg.192.168.56.112.xip.io</a>  to access our development site. We use the xip.io service for building host names. In some projects, we also put a custom index.html so when you open<a href="http://192.168.56.112.xip.io/"> </a><a href="http://192.168.56.112.xip.io">http://192.168.56.112.xip.io</a> you will see the list of tools available for the site builder.</p><p dir="ltr"> </p><h3 dir="ltr">Tools</h3><p dir="ltr">We usually set up tools like <a href="http://www.adminer.org/">Adminer.php</a>, phpinfo.php and some others for developers. One of the regularly used scripts we include is a reinstall of the site (we build our sites as installation profiles) and pull_stage.sh – a script to pull the database and files from the staging or live environments.</p><p dir="ltr"> </p><h3 dir="ltr">Pull from staging</h3><p dir="ltr">On Vagrant Box we install Drush and use it for syncing of the database and files from the remote environment. In order to have SSH login to that environment, we also copy the SSH keys to vagrant box. This can be done by adjusting the puphpet/shell/ssh-keyget.sh script by adding the following to the end of the script:</p><p><code><font size="3">echo "Copy box ssh keys to ${VAGRANT_SSH_FOLDER}"<br />cp ${VAGRANT_CORE_FOLDER}/files/dot/ssh/box_keys/* ${VAGRANT_SSH_FOLDER}/<br />chown "${VAGRANT_SSH_USERNAME}" "${VAGRANT_SSH_FOLDER}/id_rsa"<br />chown "${VAGRANT_SSH_USERNAME}" "${VAGRANT_SSH_FOLDER}/id_rsa.pub"</font><br /><font size="3">chgrp "${VAGRANT_SSH_USERNAME}" "${VAGRANT_SSH_FOLDER}/id_rsa"<br />chgrp "${VAGRANT_SSH_USERNAME}" "${VAGRANT_SSH_FOLDER}/id_rsa.pub"<br />chmod 600 ${VAGRANT_SSH_FOLDER}/*</font></code><br /><br />We generate keys, placing them in puphpet/files/dot/ssh/box_keys. Then we add the public key to our staging server and that is it. It is possible to “Vagrant SSH” to the box and then run the script to keep your database and files up to date.</p><p dir="ltr">When we pull a database from staging we, of course, sanitize email addresses and adjust settings (for example, switching to Sandbox environments of third party systems that we integrate with, etc.).</p><p dir="ltr"> </p><h3 dir="ltr">Drupal's settings.php file</h3><p dir="ltr">On the Drupal side, we also create a sites/default/dev_settings.php file with all the settings for the database, memcache and any other parameters needed for development. So the only thing developers need to do is to copy this file to settings.php and run the reinstall.sh script to set the site up.</p><p dir="ltr"> </p><h3 dir="ltr">Configuration changes</h3><p dir="ltr">Let’s say we have added memcache to the project, or Apache Solr. The only thing that we need to do is to commit the Vagrant configuration changes to the repo and ask everyone to run “vagrant provision”. Doing this will set everyone's environment to the current state. This is why we love Vagrant and see the benefits of using it every day.</p><p dir="ltr"> </p><h3 dir="ltr">Downsides of Using Vagrant</h3><p dir="ltr">We need to have enough RAM. Usually we assign 1Gb for each box. Preferably, a development machine should have 8Gb of RAM because some of our projects have multiple boxes. Another preferable thing is having SSD. What this means is that if you have pretty decent laptop, you should have everything in place to try Vagrant out.</p><p dir="ltr"> </p><h3 dir="ltr">Conclusion</h3><p>We find using Vagrant to be extremely effective. It allows our teams to work together more efficiently to deliver some of the biggest, most complex Drupal projects in the industry. Adopting a virtual development environment has had a positive effect on our development workflow, getting rid of past pressure points in our process. To learn more about how we can help your Drupal project succeed, please <a href="/contact">contact us</a>.</p></div></div></div><div class="field field-name-field-tags field-type-taxonomy-term-reference field-label-above"><div class="field-label">Tags:&nbsp;</div><div class="field-items"><div class="field-item even"><a href="/tags/vagrant" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Vagrant</a></div><div class="field-item odd"><a href="/tags/drupal" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Drupal</a></div><div class="field-item even"><a href="/tags/development" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Development</a></div></div></div><div class="field field-name-field-service-category field-type-taxonomy-term-reference field-label-above"><div class="field-label">Service category:&nbsp;</div><div class="field-items"><div class="field-item even"><a href="/services/technology" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Technology</a></div></div></div><div class="field field-name-field-drupal-planet field-type-taxonomy-term-reference field-label-above"><div class="field-label">Check this option to include this post in Planet Drupal aggregator:&nbsp;</div><div class="field-items"><div class="field-item even"><a href="/drupal/planet" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">planet</a></div></div></div><div class="field field-name-field-topics field-type-taxonomy-term-reference field-label-above"><div class="field-label">Topics:&nbsp;</div><div class="field-items"><div class="field-item even"><a href="/topics/tech-development" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Tech &amp; Development</a></div></div></div>
  </body>
</html>

