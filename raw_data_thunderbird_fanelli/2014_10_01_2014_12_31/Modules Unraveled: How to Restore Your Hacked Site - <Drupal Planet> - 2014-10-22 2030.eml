X-Mozilla-Status: 0000
X-Mozilla-Status2: 00000000
X-Mozilla-Keys:                                                                                
Date: Wed, 22 Oct 2014 18:30:00 +0000
Message-Id: <http://drupal.org/planet/rss.xml#Wed, 22 Oct 2014 18:30:00 +0000@localhost.localdomain>
From: <Drupal Planet>
MIME-Version: 1.0
Subject: Modules Unraveled: How to Restore Your Hacked Site
Content-Transfer-Encoding: 8bit
Content-Base: http://modulesunraveled.com/blog/how-restore-your-hacked-site
Content-Type: text/html; charset=UTF-8

<html>
  <head>
    <title>Modules Unraveled: How to Restore Your Hacked Site</title>
    <base href="http://modulesunraveled.com/blog/how-restore-your-hacked-site">
  </head>
  <body id="msgFeedSummaryBody" selected="false">
    <span class="submitted-by"></span><div class="field field--name-field-embed field--type-text-long field--label-hidden"><div class="field__items"><div class="field__item even"><div id="wistia_83qx445pe6" class="wistia_embed" style="width:1220px;height:686px;">
<div itemprop="video" itemscope="" itemtype="http://schema.org/VideoObject"><meta itemprop="name" content="RestoreAHackedSite" /><meta itemprop="duration" content="PT9M16S" /><meta itemprop="thumbnailUrl" content="https://embed-ssl.wistia.com/deliveries/10bb3cdf0b6267397bcafe68fe8fa029e6510a2f.bin" /><meta itemprop="contentURL" content="https://embed-ssl.wistia.com/deliveries/507a79a6ebc7270b535dcccc0eb864b45624e02e.bin" /><meta itemprop="embedURL" content="https://embed-ssl.wistia.com/flash/embed_player_v2.0.swf?2013-10-04&amp;controlsVisibleOnLoad=true&amp;customColor=7b796a&amp;fullscreenDisabled=true&amp;hdUrl%5B2pass%5D=true&amp;hdUrl%5Bext%5D=flv&amp;hdUrl%5Bheight%5D=720&amp;hdUrl%5Bsize%5D=165862158&amp;hdUrl%5Btype%5D=hdflv&amp;hdUrl%5Burl%5D=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2Fe8932917f22df2931cdfd21096e29d7f147383a8.bin&amp;hdUrl%5Bwidth%5D=1280&amp;mediaDuration=556.695&amp;showVolume=true&amp;stillUrl=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2F10bb3cdf0b6267397bcafe68fe8fa029e6510a2f.bin%3Fimage_crop_resized%3D640x360&amp;unbufferedSeek=false&amp;videoUrl=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2F507a79a6ebc7270b535dcccc0eb864b45624e02e.bin" /><meta itemprop="uploadDate" content="2014-10-22T16:43:32Z" /><object id="wistia_83qx445pe6_seo" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" style="display:block;height:686px;position:relative;width:1220px;"><param name="movie" value="https://embed-ssl.wistia.com/flash/embed_player_v2.0.swf?2013-10-04" /><param name="allowfullscreen" value="true" /><param name="bgcolor" value="#000000" /><param name="wmode" value="opaque" /><param name="flashvars" value="controlsVisibleOnLoad=true&amp;customColor=7b796a&amp;fullscreenDisabled=true&amp;hdUrl%5B2pass%5D=true&amp;hdUrl%5Bext%5D=flv&amp;hdUrl%5Bheight%5D=720&amp;hdUrl%5Bsize%5D=165862158&amp;hdUrl%5Btype%5D=hdflv&amp;hdUrl%5Burl%5D=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2Fe8932917f22df2931cdfd21096e29d7f147383a8.bin&amp;hdUrl%5Bwidth%5D=1280&amp;mediaDuration=556.695&amp;showVolume=true&amp;stillUrl=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2F10bb3cdf0b6267397bcafe68fe8fa029e6510a2f.bin%3Fimage_crop_resized%3D640x360&amp;unbufferedSeek=false&amp;videoUrl=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2F507a79a6ebc7270b535dcccc0eb864b45624e02e.bin" /><embed src="https://embed-ssl.wistia.com/flash/embed_player_v2.0.swf?2013-10-04" allowfullscreen="true" bgcolor="#000000" flashvars="controlsVisibleOnLoad=true&amp;customColor=7b796a&amp;fullscreenDisabled=true&amp;hdUrl%5B2pass%5D=true&amp;hdUrl%5Bext%5D=flv&amp;hdUrl%5Bheight%5D=720&amp;hdUrl%5Bsize%5D=165862158&amp;hdUrl%5Btype%5D=hdflv&amp;hdUrl%5Burl%5D=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2Fe8932917f22df2931cdfd21096e29d7f147383a8.bin&amp;hdUrl%5Bwidth%5D=1280&amp;mediaDuration=556.695&amp;showVolume=true&amp;stillUrl=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2F10bb3cdf0b6267397bcafe68fe8fa029e6510a2f.bin%3Fimage_crop_resized%3D640x360&amp;unbufferedSeek=false&amp;videoUrl=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2F507a79a6ebc7270b535dcccc0eb864b45624e02e.bin" name="wistia_83qx445pe6_html" style="display:block;height:100%;position:relative;width:100%;" type="application/x-shockwave-flash" wmode="opaque"></embed></object><p></p><noscript itemprop="description">RestoreAHackedSite</noscript></div>
</div>
<script charset="ISO-8859-1" src="//fast.wistia.com/assets/external/E-v1.js"></script><script>
<!--//--><![CDATA[// ><!--

wistiaEmbed = Wistia.embed("83qx445pe6", {
  videoFoam: true
});

//--><!]]>
</script><script charset="ISO-8859-1" src="//fast.wistia.com/embed/medias/83qx445pe6/metadata.js"></script></div></div></div><div class="field field--name-body field--type-text-with-summary field--label-hidden"><div class="field__items"><div class="field__item even" property="content:encoded"><h2>tl;dr</h2>
<p><em>Rollback a server backup (files and database) from before October 15th 2014.</em></p>
<p><strong>No server backup?</strong></p>
<ol><li>Run "git status" to find new and modified files.
<ul><li>Delete new files</li>
<li>Checkout modified files</li>
</ul></li>
<li>Thouroughly check files directory for anything unusual.</li>
<li>Make sure the .htaccess file in the files directory restricts code execution</li>
<li>Restore database from pre Oct. 15th backup</li>
<li>Update Drupal Core to latest release</li>
</ol><p>... Read on for details...</p>
<h2>I think I might have been hacked. What do I do?</h2>
<p>Hi, this is Brian Lewis with Modules Unraveled.</p>
<p>As you probably already know, there was a huge security fix released for Drupal 7 on October 15th (<a href="https://www.drupal.org/SA-CORE-2014-005">SA-CORE-2014-005</a>). The patch to update Drupal is actually quite small, but the implications of not updating your site are massive. As a matter of fact, if you haven't already updated your site, <strong>chances are you have already been hacked.</strong> There were automated programs systematically attacking Drupal sites hours after the fix was released. In this video I'm going to show you how to find out whether or not your site has been hacked. And if so, I'll walk you through what you need to do now, to reduce the damage done.</p>
<p>There are two ways to find out whether your site has been hacked. With "git status" and by searching the database.</p>
<ul><li>Run "git status" inside Drupal root
<ul><li>This will show us any files that have been modified since our last commit. On the live server, there shouldn't be any, so anything listed here, I know is a result of being hacked.</li>
<li>This is a huge reason you should be using version control on your site. If you're not, you can try to re-download every module, theme and library you have and download a fresh copy of the version of Drupal core that you had before the attack and replace all of those on your server. I'm hesitant to recommend this as a full fix though, because there may be hidden files, or files in places you don't think to look. Really, my recommendation is a full re-install. If you're in this situation, I'm sure you don't want to hear that, but I hope this gives you a reason to look into Git.</li>
</ul></li>
<li>Search for "file_put_contents" in database
<ul><li>If there is a result. You've been hacked.</li>
<li>Click "Browse".</li>
<li>Click the "BLOB" link under "access_arguments". This should download a file to your local machine.</li>
<li>Open that file with a text editor.</li>
<li><em>Notice that only one file is listed. There may be others that need to be deleted.</em></li>
</ul></li>
<li>If there are no extra files in your git repo, and no results in database search. You're not hacked. Update Drupal Core now! Or at least do the hotfix mentioned <a href="https://drupalize.me/blog/201410/tips-applying-drupal-core-security-updates">here</a> as a <em>temporary</em> measure.</li>
<li>Delete/checkout all files listed by "git status" (Also check your files directory. The files directory should not be in Git, but that means there's no easy way to view new and modified files, but they could have been placed there. By default, the .htaccess file that is in that directory prevents php code from being executed, but Michael said he has seen an attack that modified that .htaccess file. So, you need to check your site.)</li>
<li>Restore Database (Otherwise thouroughly check Users, Node, etc.)</li>
<li>Install latest Drupal Core update</li>
</ul><h2>Recap:</h2>
<ol><li>Run "git status" to find new and modified files.
<ul><li>Delete new files</li>
<li>Checkout modified files</li>
</ul></li>
<li>Thouroughly check files directory for anything unusual.</li>
<li>Make sure the .htaccess file in the files directory restricts code execution</li>
<li>Restore database from pre Oct. 15th backup</li>
<li>Update Drupal Core to latest release</li>
</ol><h2>Updates:</h2>
<ol><li>Drupal security team member Greg Knaddison (<a href="https://www.drupal.org/u/greggles">greggles</a>) wrote up a great guide on what to do when you get hacked. He includes things I didn't mention like making a forensic copy of your site to inspect later, and notifying site stakeholders. You can read that <a href="https://github.com/greggles/cracking-drupal/blob/master/after-an-exploit.md">here</a>.</li>
</ol></div></div></div><div class="field field--name-field-tags field--type-taxonomy-term-reference field--label-above"><div class="field__label">Tags:&nbsp;</div><div class="field__items"><div class="field__item even" rel="dc:subject"><a href="/tags/security" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Security</a></div><div class="field__item odd" rel="dc:subject"><a href="/planet-drupal" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">planet-drupal</a></div></div></div>
  </body>
</html>

